# 操作系统学习（二十二）—— 生产者-消费者问题

## 问题描述

系统中有一组生产者进程和一组消费者进程，生产者进程每次生产一个产品放入缓冲区，消费者进程每次从缓冲区中取出一个产品并使用。（注：这里的“产品” 理解为某种数据）

生产者、消费者共享一个初始为空、大小为n的缓冲区。

只有缓冲区没满时，生产者才能把产品放入缓冲区中，否则必须等待。

只有缓冲区不空时，消费者才能从中取出产品，否则必须等待。

缓冲区是临界资源，各进程必须互斥地访问。

![image-20200805134504649](F:\笔记\操作系统\assets\操作系统学习（二十二）.png)

> PV操作题目分析步骤：
>
> 1. 关系分析。找出题目中描述的各个进程，分析它们之间的同步、互斥关系。
> 2. 整理思路。根据各进程的操作流程确定 P、V 操作的大致顺序。
> 3. 设置信号量。设置需要的信号量，并根据题目条件确定信号量初始值。（互斥信号量初值一般 1，同步信号量的初始值要看对应资源的初始值是多少）

回到本题：

semaphore mutex = 1; //互斥信号量，实现对缓冲区的互斥访问

semaphore empty = n; //同步信号量，表示空闲缓冲区的数量

semaphore full = 0; //同步信号量，表示产品的数量，也即非空缓冲区的数量

## 如何实现

![image-20200805140042495](F:\笔记\操作系统\assets\操作系统学习（二十二）-2.png)

![image-20200806032715352](F:\笔记\操作系统\assets\操作系统学习（二十二）-8.png)

>注意要保持  P、V 顺序，实现互斥的 P 操作一定要在实现同步的 P 操作之后

![image-20200806033441900](F:\笔记\操作系统\assets\操作系统学习（二十二）-7.png)

![image-20200806033544474](F:\笔记\操作系统\assets\操作系统学习（二十二）-9.png)